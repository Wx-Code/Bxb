<?xml version="1.0" encoding="utf-8" ?>
<SmartSqlMap Scope="User"  xmlns="http://SmartSql.net/schemas/SmartSqlMap.xsd">
  <Caches>
    <Cache Id="UserCache" Type="Lru">
      <FlushInterval Hours="1"/>
    </Cache>
  </Caches>

  <Statements>

    <!-- 字段 -->
    <Statement Id="Fields">
      `UserId`, `Nickname`, `Avatar`, `UserType`, `Realname`, `ShareId`, `ShareNickname`, `WxUnionId`,`ShakeWxOpenId`, `WxOpenId`, `IdCard`, `Phone`, `IdCardFrontPhoto`, `IdCardBackPhoto`, `Authenticated`, `BankAccountName`, `BankAccountNumber`, `BankName`, `BankCode`, `BankInfoFilled`, `CreatedTime`, `Deleted`, `Subscribed`, `IsNewUser`
    </Statement>

    <!-- 新增 -->
    <Statement Id="Insert">
      INSERT INTO
      `User`
      (
      Nickname, Avatar, ShareId, ShareNickname, SourceType
      <IsNotEmpty Prepend="," Property="WxUnionId"> WxUnionId </IsNotEmpty>
      <IsNotEmpty Prepend="," Property="WxOpenId"> WxOpenId </IsNotEmpty>
      <IsNotEmpty Prepend="," Property="ShakeWxOpenId"> ShakeWxOpenId </IsNotEmpty> ,UserType, Subscribed,ShakeH5WxOpenId
      )
      VALUES
      (
      ?Nickname, ?Avatar, ?ShareId, ?ShareNickname,?SourceType, ?WxUnionId <IsNotEmpty Prepend="," Property="WxOpenId">?WxOpenId </IsNotEmpty><IsNotEmpty Prepend="," Property="ShakeWxOpenId"> ?ShakeWxOpenId </IsNotEmpty> ,?UserType, ?Subscribed,?ShakeH5WxOpenId
      )
      ;
      SELECT LAST_INSERT_ID();
    </Statement>

    <!-- 更新 -->
    <Statement Id="Update">
      UPDATE
      `User`
      <Set>
        <IsNotEmpty Prepend="," Property="Nickname">
          Nickname=?Nickname
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="Avatar">
          Avatar=?Avatar
        </IsNotEmpty>
        <IsGreaterThan CompareValue="0" Prepend="," Property="UserType">
          UserType=?UserType
        </IsGreaterThan>
        <IsNotEmpty Prepend="," Property="Realname">
          Realname=?Realname
        </IsNotEmpty>
        <IsGreaterThan CompareValue="0" Prepend="," Property="ShareId">
          ShareId=?ShareId
        </IsGreaterThan>
        <IsNotEmpty Prepend="," Property="ShareNickname">
          ShareNickname=?ShareNickname
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="WxUnionId">
          WxUnionId=?WxUnionId
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="ShakeWxOpenId">
          ShakeWxOpenId=?ShakeWxOpenId
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="WxOpenId">
          WxOpenId=?WxOpenId
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="Subscribed">
          Subscribed=?Subscribed
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="IdCard">
          IdCard=?IdCard
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="Phone">
          Phone=?Phone
        </IsNotEmpty>
        <IsTrue Prepend="," Property="Authenticated">
          Authenticated=?Authenticated
        </IsTrue>
        <IsNotEmpty Prepend="," Property="BankAccountName">
          BankAccountName=?BankAccountName
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="BankAccountNumber">
          BankAccountNumber=?BankAccountNumber
        </IsNotEmpty>
        <IsNotEmpty Prepend="," Property="BankName">
          BankName=?BankName
        </IsNotEmpty> 
        <IsNotEmpty Prepend="," Property="BankCode">
          BankCode=?BankCode
        </IsNotEmpty>
        <IsTrue Prepend="," Property="BankInfoFilled">
          BankInfoFilled=?BankInfoFilled
        </IsTrue>
      </Set>
      <Where>
        `UserId`=?UserId
      </Where>
      ;
    </Statement>

    <!-- 查询 单条数据 -->
    <Statement Id="QuerySingle">
      SELECT
      <Include RefId="Fields"></Include>
      FROM
      `User`
      <Where>
        <IsGreaterThan CompareValue="0" Prepend="AND" Property="userId">
          `UserId`=?userId
        </IsGreaterThan>
        <IsNotEmpty Prepend="AND" Property="openId">
          `WxOpenId`=?openId OR `ShakeWxOpenId`=?openId OR `ShakeH5WxOpenId`=?openId
        </IsNotEmpty>
        <IsNotEmpty Prepend="AND" Property="unionId">
          `WxUnionId`=?unionId
        </IsNotEmpty>
        AND `Deleted`=0
      </Where>
      LIMIT 1
      ;
    </Statement>
   
  </Statements>
</SmartSqlMap>